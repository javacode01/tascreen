//市场主体发展分析controller
indexApp.controller("scztfzfbtCtrl",['$scope','ChartService','$window',function($scope,ChartService,$window){
	$scope.nd = (new Date()).getFullYear();
	var w = angular.element($window);
    w.bind('resize', function(){
	    console.log("捕获屏幕大小改变时间============="+new Date());
	    ztfzrlfbtChart.resize();
    });
    //初始化数据
    var geoCoordMap = {
    		"红门所370901001":[117.13375,36.216718],
    		"中天门所370901002":[117.12002,36.24736],
    		"南天门所370901003":[117.112465,36.263025],
    		"竹林寺所370901004":[117.108749,36.228077],
    		"桃花峪所370901005":[117.067929,36.219223],
    		"天烛峰所370901006":[117.18447,36.208245],
    		"大津口所370901007":[117.147553,36.304947],
    		"黄前370901014":[117.25305,36.30394],
    		"下港370901015":[117.292909,36.361994],
    		"岱北370902001":[117.141587,36.203327],
    		"五马370902003":[117.150007,36.189936],
    		"南关370902005":[117.141518,36.173086],
    		"青山370902009":[117.191821,36.286875],
    		"上高370902012":[117.169172,36.202921],
    		"徐家楼370902013":[117.117099,36.169225],
    		"省庄370902020":[117.220363,36.203087],
    		"邱家店370902021":[117.253979,36.16246],
    		"岱庙370902022":[117.137539,36.192954],
    		"财源370902023":[117.128502,36.186189],
    		"七里370902024":[117.096943,36.194597],
    		"迎胜370902025":[117.07952,36.201861],
    		"泰前370902026":[117.156703,36.21334],
    		"工业园370902027":[117.19238,36.205893],
    		"天平370903001":[117.156703,36.21334],
    		"道朗370903002":[116.930042,36.209448],
    		"夏张370903003":[116.963123,36.102176],
    		"满庄370903004":[117.085362,36.073662],
    		"大汶口370903005":[117.092785,35.964176],
    		"马庄370903006":[117.006466,35.994868],
    		"粥店370903009":[117.079795,36.201721],
    		"城区370903010":[117.157146,36.195531],
    		"角峪370903011":[117.434217,36.178256],
    		"祝阳370903016":[117.349128,36.253568],
    		"范镇370903017":[117.383526,36.221113],
    		"山口370903018":[117.279615,36.232769],
    		"光彩370903024":[117.063282,36.188412],
    		"城关370921000":[116.803724,35.770863],
    		"磁窑370921001":[117.101212,35.912482],
    		"华丰370921002":[117.167106,35.875073],
    		"城南370921003":[117.185795,35.924622],
    		"鹤山370921004":[116.710938,35.865613],
    		"罡城370921005":[116.866636,35.872394],
    		"蒋集370921006":[116.988806,35.913368],
    		"东庄370921007":[117.211171,35.864072],
    		"葛石370921008":[116.946663,35.789851],
    		"乡饮370921010":[116.886706,35.722731],
    		"东疏370921011":[116.718347,35.75448],
    		"伏山370921012":[116.796633,35.847891],
    		"八仙桥370921013":[116.798182,35.763236],
    		"州城370923001":[116.320511,35.920763],
    		"新湖370923002":[116.315518,35.857172],
    		"沙河站370923003":[116.405845,35.812713],
    		"彭集370923004":[116.471093,35.873046],
    		"东平370923005":[116.439321,35.927874],
    		"接山370923006":[116.587408,35.955348],
    		"大羊370923007":[116.488347,36.052417],
    		"梯门370923008":[116.393182,36.036432],
    		"老湖370923009":[116.273868,36.000125],
    		"城区370923010":[116.444287,35.930156],
    		"旧县370923011":[116.250699,36.13348],
    		"戴庙370923012":[116.112025,35.971839],
    		"商老庄370923013":[116.133206,35.923832],
    		"银山370923014":[116.142822,36.067944],
    		"斑鸠店370923015":[116.182335,36.113519],
    		"北集坡370924001":[117.165745,36.079455],
    		"直属370924002":[117.18447,36.208245],
    		"天宝370924005":[117.385621,35.958165],
    		"徂徕370924008":[117.287283,36.112335],
    		"房村370924012":[117.202126,35.968512],
    		"良庄370924013":[117.252101,35.96446],
    		"化马湾370924023":[117.436199,36.084426],
    		"青云370982001":[117.764143,35.912444],
    		"翟镇370982002":[117.682546,35.952091],
    		"羊流370982003":[117.553268,35.988823],
    		"果都370982004":[117.518749,35.960694],
    		"楼德370982006":[117.326377,35.869259],
    		"宫里370982007":[117.443487,35.916722],
    		"小协370982008":[117.629502,35.906664],
    		"刘杜370982009":[117.624303,35.850876],
    		"石莱370982010":[117.509167,35.77036],
    		"新汶370982011":[117.779667,35.819402],
    		"东都370982012":[117.726477,35.851865],
    		"汶南370982013":[117.779667,35.819402],
    		"龙廷370982014":[117.92287,35.928552],
    		"岳家庄370982015":[117.632324,35.817959],
    		"谷里370982016":[117.544169,35.928905],
    		"放城370982017":[117.608268,35.701442],
    		"开发区370982018":[117.18447,36.208245],
    		"泉沟370982020":[117.6482,35.985892],
    		"西张庄370982021":[117.60291,35.962719],
    		"禹村370982023":[117.363448,35.869523],
    		"二中队370982025":[117.702532,35.874351],
    		"烟草中队370982027":[117.78673,35.89908],
    		"城区370983001":[116.779524,36.193857],
    		"新城370983002":[116.805735,36.190022],
    		"王瓜店370983003":[116.805735,36.190022],
    		"湖屯370983004":[116.603959,36.208629],
    		"石横370983005":[116.530164,36.208127],
    		"仪阳370983006":[116.799596,36.161853],
    		"安站370983007":[116.774483,36.075056],
    		"商场370983008":[116.777609,36.189872],
    		"安庄370983009":[116.78281,35.976272],
    		"边院370983012":[116.882089,36.01347],
    		"汶阳370983013":[116.895867,35.962561],
    		"孙伯370983014":[116.694281,35.966279],
    		"老城370983015":[116.782154,36.232693],
    		"潮泉370983016":[116.841802,36.225914],
    		"桃园370983017":[116.646121,36.14768],
    		"王庄370983018":[116.757299,36.217874]
    	};
	var convertData = function (data) {
	    var res = [];
	    for (var i = 0; i < data.length; i++) {
	        var geoCoord = geoCoordMap[data[i].name];
	        if (geoCoord) {
	            res.push(geoCoord.concat(data[i].value));
	        }
	    }
	    return res;
	};
    //初始化泰安市热力图
    var ztfzrlfbtOption = {
    		tooltip : {
    			trigger: 'item'
		    },
		    visualMap: {
		    	show:false,
		    	min:0,
		    	max:100,
		    	calculable: true,
		    	inRange: {
	                color: ['blue', 'green', 'green', 'yellow', 'red']
	            },
	            text:['高','低'],
	            textStyle: {
	            	color:'#00E1FC'
		        }
		    },
		    geo: {
		    	map: 'taian',
		    	layoutCenter: ['50%', '50%'],
	            layoutSize: '150%',
	            roam:false,
		    	label: {
		    		show:true,
		    		color:'#FFFFFF',
		    		fontSize:16,
		            emphasis: {
		                show: false
		            }
		        },
		        itemStyle: {
		            normal: {
		                areaColor: '#3092E7',
		                borderColor: '#eeeeee'
		            },
		            emphasis: {
		                areaColor: '#46bee9'
		            }
		        }
		    },
		    series: [{
	            name: '主体数量',
	            type: 'heatmap',
	            coordinateSystem: 'geo',
	            blurSize:20,
	            data: convertData([]),
	            animation: true,
	            minOpacity:0.1
	        }]
    };
    var ztfzrlfbtChart = ChartService.init("ztfzrlfbt",ztfzrlfbtOption);
    
    $scope.search = function(){
    	ChartService.setData('scztfzfbt/getGssztslData?startTime='+$scope.nd+'-01-01&endTime='+$scope.nd+"-12-31",function(data){
        	console.log("各工商所主体数量："+JSON.stringify(data));
        	ztfzrlfbtChart.setOption({
        		series:[{
        			data: convertData(data.result)
        		}]
        	});
        });
    };
    $scope.search();
}]);